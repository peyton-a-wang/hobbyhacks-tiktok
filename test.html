<!DOCTYPE html>
<html>
    <style>
 .wrap {
  position:relative;
}

video {
  width:100%;
  height:100%;
    z-index:-100;
}
.overlay {
  position:fixed;
  top:0;
  width:25%;
  z-index:25;
  text-align:center;
}
img {
  display:inline-block;
}

#webcam{
    position: fixed;
    top: 0;
    left: 0;
    min-width: 100%;
    min-height: 100%;
    width: auto;
    height: auto;
    z-index: -100;
    transform: rotateY(180deg);
    pointer-events: none;
    -webkit-transform:rotateY(180deg); /* Safari and Chrome */
    -moz-transform:rotateY(180deg); /* Firefox */
  }
  
  #canvas-source{
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    min-width: 100%;
    min-height: 100%;
    width: auto;
    height: auto;
    z-index: -100;
    transform: translateX(-50%) translateY(-50%);
    pointer-events: none;
  }

  #canvas-blended {
    width: 100%;
  }


  .dot-container{
      width: 100vw;
      height: 100vh;
      top: 0;
      left: 0;
      position: absolute;
  }

  .dot-background{
    width: 100vw;
    position: relative;
    height: 100vh;
    overflow: hidden;
    background: black;
  }

  .dot-container img{
      width: 100%;
      opacity: 0.5;
      filter: alpha(opacity=50);
  }
  .dot-background img{
      width: 100%;
      opacity: 0.5;
      filter: alpha(opacity=50);
  }

  .drum-container{
      width: 100vw;
      height: 100vh;
      top: 0;
      left: 0;
      position: absolute;
  }

  .dot-background{
    width: 100vw;
    position: relative;
    height: 100vh;
    overflow: hidden;
    background: black;
  }

  .dot-container img{
      width: 100%;
      opacity: 0.5;
      filter: alpha(opacity=50);
  }
  .dot-background img{
      width: 100%;
      opacity: 0.5;
      filter: alpha(opacity=50);
  }

  .app-panel .row{
      position: absolute;
      left: 0;
      width: 100vw;
      padding: 0;
      margin: 0;
  }

  .app-panel .row-top{
      top: 0;
  }

  .app-panel .row-bottom{
      bottom: 0;
  }
  @media screen and (min-width: 1140px) {
    .app-panel .row-bottom{
        bottom: -20vh;
    }
}
  @media screen and (max-width: 576px) {
    .app-panel .row-bottom{
      top: 0;
      margin-left: 60%;
      margin-top: -35px;
    }
    .app-panel .row-top{
      top: 0;
    }
    .drum-background .row-bottom{
      left: 60%;
      position: relative;
      top: -180px;
    }
}

.spinner-grow{
  position: absolute; 
  width: 100%;
  top:0;
  left:0;
}

#web-link {
  z-index: 999999;
  left: 10px;
  top: 10%;
  position: absolute;
}

#web-link a {
  color: white;
  text-decoration: underline;
}


.md-modal {
  margin: auto;
	position: fixed;
	top: 0;
	left: 0;
  right: 0;
	width: 100vw;
	height: 100vh;
	z-index: 2000;
	visibility: hidden;
	-webkit-backface-visibility: hidden;
	-moz-backface-visibility: hidden;
	backface-visibility: hidden;
}

.md-show {
	visibility: visible;
}

.md-overlay {
	position: fixed;
	width: 100%;
	height: 100%;
	visibility: hidden;
	top: 0;
	left: 0;
	z-index: 1000;
	opacity: 0;
	background: rgba(#e4f0e3, 0.8);
	-webkit-transition: all 0.3s;
	-moz-transition: all 0.3s;
	transition: all 0.3s;
}

.md-show ~ .md-overlay {
	opacity: 1;
	visibility: visible;
}

.md-effect-12 .md-content {
	-webkit-transform: scale(0.8);
	-moz-transform: scale(0.8);
	-ms-transform: scale(0.8);
	transform: scale(0.8);
	opacity: 0;
	-webkit-transition: all 0.3s;
	-moz-transition: all 0.3s;
	transition: all 0.3s;
}

.md-show.md-effect-12 ~ .md-overlay {
	background-color: #e4f0e3;
} 

.md-effect-12 .md-content h3,
.md-effect-12 .md-content {
	background: transparent;
}

.md-show.md-effect-12 .md-content {
	-webkit-transform: scale(1);
	-moz-transform: scale(1);
	-ms-transform: scale(1);
	transform: scale(1);
	opacity: 1;
}

#errorMsg {
  position: fixed;
  top: 20vh;
  left: 0;
  padding: 20px;
  z-index: 999999;
}

@media screen and (min-width: 768px) {
 #errorMsg {
     position: fixed;
     top: 30vh;
     left: 20vw;
     padding: 20px;
     z-index: 999999;
 }
}
    </style>
<body>
    <video id="webcam" autoplay playsinline width="640" height="480"></video>
        <canvas id="canvas" class="d-none"></canvas>
        <audio id="snapSound" src="audio/snap.wav" preload = "auto"></audio>
        <script type="text/javascript" src="https://unpkg.com/webcam-easy/dist/webcam-easy.min.js"></script>
   
    <div class="wrap"><video id="video">

    <script>
        const webcamElement = document.getElementById('webcam');
        const canvasElement = document.getElementById('canvas');
        const snapSoundElement = document.getElementById('snapSound');
        const webcam = new Webcam(webcamElement, 'user', canvasElement,snapSoundElement);

        webcam.start()
        .then(result =>{
            console.log("webcam started");
        })
        .catch(err => {
            console.log(err);
        });

        let picture = webcam.snap();
        document.querySelector('#download-photo').href = picture;
    </script>
    </video>
<div class="dot-container">
<div class="overlay">
    <img class="dot" src="images/halftone-744404_640.png" name="crash" vd-id='0'>
</div>
</div>
</div>

<p id="demo"></p>

<script>
    
    $('.dot').on('load', function () {
    var viewWidth = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);
    var viewHeight = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
    var ratioWidth = canvasBlended.width/viewWidth;
    var ratioHeight = canvasBlended.height/viewHeight;
    dot[this.attributes['vd-id'].value] = {
        id: this.attributes['vd-id'].value,
        name: this.attributes['name'].value,
        width: this.width * ratioWidth,
        height: this.height * ratioHeight,
        x: this.x * ratioWidth,
        y: this.y * ratioHeight
    }
}).each(function() {
     if (this.complete) $(this).trigger('load');
});
document.getElementById("demo").innerHTML = 5 + 6;
function drawVideo() {
    contextSource.drawImage(webcamElement, 0, 0, webcamElement.width, webcamElement.height);
}

function blend() {
    var width = canvasSource.width;
    var height = canvasSource.height;
    // get webcam image data
    var sourceData = contextSource.getImageData(0, 0, width, height);
    // create an image if the previous image doesnâ€™t exist
    if (!lastImageData) lastImageData = contextSource.getImageData(0, 0, width, height);
    // create a ImageData instance to receive the blended result
    var blendedData = contextSource.createImageData(width, height);
    // blend the 2 images
    differenceAccuracy(blendedData.data, sourceData.data, lastImageData.data);
    // draw the result in a canvas
    contextBlended.putImageData(blendedData, 0, 0);
    // store the current webcam image
    lastImageData = sourceData;
}
document.getElementById("demo").innerHTML = 5 + 6;
function differenceAccuracy(target, data1, data2) {
    if (data1.length != data2.length) return null;
    var i = 0;
    while (i < (data1.length * 0.25)) {
        var average1 = (data1[4*i] + data1[4*i+1] + data1[4*i+2]) / 3;
        var average2 = (data2[4*i] + data2[4*i+1] + data2[4*i+2]) / 3;
        var diff = threshold(fastAbs(average1 - average2));
        target[4*i] = diff;
        target[4*i+1] = diff;
        target[4*i+2] = diff;
        target[4*i+3] = 0xFF;
        ++i;
    }
}

function update() {
  drawVideo();
  blend();
  checkAreas();
  window.requestAnimationFrame(update);
}
document.getElementById("clickme").innerHTML = 5 + 6;
function checkAreas() {
    // loop over the drum areas
    for (var dotName in dots) {
        var dott = dot[dotName];
        if(dott.x>0 || dott.y>0){
          var blendedData = contextBlended.getImageData(dott.x, dott.y, dott.width, dott.height);
          var i = 0;
          var average = 0;
          // loop over the pixels
          while (i < (blendedData.data.length * 0.25)) {
              // make an average between the color channel
              average += (blendedData.data[i*4] + blendedData.data[i*4+1] + blendedData.data[i*4+2]) / 3;
              ++i;
          }
          // calculate an average between of the color values of the drum area
          average = Math.round(average / (blendedData.data.length * 0.25));
          document.getElementById("demo").innerHTML = 5 + 6;
          if (average > 0) {
              // over a small limit, consider that a movement is detected
              // play a note and show a visual feedback to the user
              console.log(dot.name + '-' + average)
              document.getElementById("demo").innerHTML = 5 + 6;
                    
          }
        }
    }
}

print(count)
</script>
<buttons id="clickme">Click me: </buttons>
</body>
</html>



